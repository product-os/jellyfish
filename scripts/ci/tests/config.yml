jobs:
  clean-github:
    description: 'GitHub Test Data Cleanup'
    command: 'make clean-github'
    required: false
  clean-front:
    description: 'Front Test Data Cleanup'
    command: 'make clean-front'
    required: false
  pipeline:
    description: 'Pipeline Sync Tests'
    command: 'make test'
    required: true
    environment:
      FILES: './test/integration/sync/pipeline.spec.js'
  s3-file-upload:
    description: 'S3 File Upload Tests'
    command: 'env && make test'
    required: true
    environment:
      FILES: './test/e2e/ui/file-upload.spec.js'
      FS_DRIVER: 's3FS'
  e2e-livechat:
    description: 'E2E Livechat Tests'
    command: 'env && make test-e2e-livechat'
    required: true
    depends_on:
      - s3-file-upload
  e2e-ui:
    description: 'E2E UI Tests'
    command: 'make test-e2e-ui'
    required: true
    environment:
      INTEGRATION_OUTREACH_APP_ID: ''
    depends_on:
      - e2e-livechat
  balena-api-translate:
    description: 'Balena API Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'balena-api-translate.spec.js'
      FILES: './test/integration/sync/balena-api-translate.spec.js'
    depends_on:
      - e2e-ui
      - pipeline
  github-translate:
    description: 'GitHub Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'github-translate.spec.js'
      FILES: './test/integration/sync/github-translate.spec.js'
      INTEGRATION_GITHUB_TOKEN: 'foobar'
    depends_on:
      - balena-api-translate
  flowdock-translate:
    description: 'Flowdock Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'flowdock-translate.spec.js'
      FILES: './test/integration/sync/flowdock-translate.spec.js'
    depends_on:
      - github-translate
  typeform-translate:
    description: 'Typeform Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'typeform-translate.spec.js'
      FILES: './test/integration/sync/typeform-translate.spec.js'
    depends_on:
      - flowdock-translate
  integration-core:
    description: 'Core Integration Tests'
    command: 'make test-integration-core'
    required: true
    depends_on:
      - e2e-ui
      - pipeline
  integration-queue:
    description: 'Queue Integration Tests'
    command: 'make test-integration-queue'
    required: true
    depends_on:
      - integration-core
  integration-server:
    description: 'Server Integration Tests'
    command: 'make test-integration-server'
    required: true
    environment:
      SERVER_HOST: 'http://localhost'
    depends_on:
      - integration-queue
  integration-worker:
    description: 'Worker Integration Tests'
    command: 'make test-integration-worker'
    required: true
    depends_on:
      - integration-server
  front-translate:
    description: 'Front Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'front-translate.spec.js'
      FILES: './test/integration/sync/front-translate.spec.js'
      INTEGRATION_FRONT_TOKEN: 'foobar'
    depends_on:
      - typeform-translate
      - integration-worker
      - e2e-ui
  discourse-translate:
    description: 'Discourse Translate Tests'
    command: './scripts/ci/skip_tests_if_only.sh ui livechat || make test'
    required: true
    environment:
      CHECK_FOR: 'discourse-translate.spec.js'
      FILES: './test/integration/sync/discourse-translate.spec.js'
    depends_on:
      - typeform-translate
      - integration-worker
      - e2e-ui
